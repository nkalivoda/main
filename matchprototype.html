<html>
<head><title>Syntax prosody interface application</title></head>

<body style="padding-left: 5%; padding-right: 5%; padding-top: 20px">
	<h2>Syntax prosody interface application</h2>
	<pre id="results-container"></pre>

<style>
	.report-line {
		font-size: 14px;
		line-height: 110%;
	}
	.main-report-line {
		font-weight: bold;
		line-height: 180%;
		background-color: #ccc;
		color: green;
		border-radius: 5px;
		border: 1px solid gray;
		padding-left: 5px;
		padding-right: 5px;
		padding-top: 2px;
		padding-bottom: 2px;
	}
	.expected-violation-count, .actual-violation-count {
		color: red;
	}
	
	.tableau {
		border-collapse: collapse;
		margin-bottom: 20px;
	}
	.tableau, .tableau th, .tableau td, .tableau {
		border: 1px solid black;
	}
	.tableau th, .tableau td {
		padding: 4px;
	}
	.tableau td {
		text-align: right;
	}
	.tableau .candidate {
		font-weight: bold;
	}
	
	.segment-hidden {
		display: none !important;
	}
	.tableau-textarea {
		display: inline-block;
		width: 30em;
		height: 3em;
		font-size: 8px;
	}
</style>

<script>
var lastSegmentId = 0, nextSegmentToReveal = 0;


var logLines = [];
function logreport(line){
	logLines.push(['<span class="report-line segment-', lastSegmentId, (lastSegmentId >= nextSegmentToReveal) ? ' segment-hidden' : '', '">', line, '<br></span>'].join(''));
	flushLog();
}
logreport.debug = function() {
	if (logreport.debug.on)
		return logreport.call(this, Array.prototype.slice.call(arguments));
}
logreport.debug.on = true;

var resultsContainer;
function flushLog() {
	if (resultsContainer) {
		var fragment = document.createElement('div');
		fragment.innerHTML = logLines.join('');
		resultsContainer.appendChild(fragment);
		logLines = [];
	} else {
		console.error('Tried to flush log before window loaded.');
	}
}

function writeTableau(tableauContent) {
	if (resultsContainer) {
		var tableauContainer = document.createElement('div');
		
		tableauContainer.innerHTML =  '<h3 style="margin-bottom: 5px">Tableau</h3>';
		
		var htmlTableauContainer = document.createElement('div');
		htmlTableauContainer.innerHTML = tableauToHtml(tableauContent);
		tableauContainer.appendChild(htmlTableauContainer);		
		
		var textareaNote = document.createElement('strong');
		textareaNote.innerHTML = 'For copying and pasting into OTWorkplace: ';
		tableauContainer.appendChild(textareaNote);
		
		var textarea = document.createElement('textarea');
		textarea.className = 'tableau-textarea';
		textarea.value = tableauToCsv(tableauContent, '\t');
		textarea.readOnly = true;
		tableauContainer.appendChild(textarea);
		tableauContainer.className += ' segment-' + lastSegmentId;
		if (lastSegmentId >= nextSegmentToReveal)
			tableauContainer.className += ' segment-hidden';
		onRevealSegment[lastSegmentId] = function() {
			textarea.focus();
			textarea.select();
		}
		
		resultsContainer.appendChild(tableauContainer);
		
	} else {
		console.error('Tried to write tableau before window loaded.');
	}
}

window.addEventListener('load', function(){
	resultsContainer = document.getElementById('results-container');
	
	runDemo();
});


var onRevealSegment = {};

function revealNextSegment() {
	if (nextSegmentToReveal > lastSegmentId)
		return;
	var elements = document.getElementsByClassName('segment-' + nextSegmentToReveal);
	for (var i = 0; i < elements.length; i++)
		elements[i].className = elements[i].className.replace('segment-hidden', '');

	if (onRevealSegment[nextSegmentToReveal])
		onRevealSegment[nextSegmentToReveal]();

	window.scrollTo(0, document.body.scrollHeight);

	nextSegmentToReveal++;
}

document.addEventListener('keyup', function(event) {
	if (event.keyCode === 32)
		revealNextSegment();
});

function runConstraint(constraint, sname, pname, cat, expectedViolations) {
	logreport(['<span class="main-report-line">Running ', constraint, '(', (cat || ''), ') on (', sname, ', ', pname, ')', (expectedViolations == null) ? '' : [' - Expected Violations: <span class="expected-violation-count">', expectedViolations, '</span>'].join(''), '</span>'].join(''));
	var violationCount = window[constraint](window[sname], window[pname], cat);
	logreport(['<span class="main-report-line" style="background-color: white">Actual Violations: <span class="actual-violation-count">', violationCount, '</span></span><br/><br/>'].join(''));
	return violationCount;
}
</script>

<script src="tableauMaker.js"></script>

<script src="trees.js"></script>
<script src="MyrbergTrees.js"></script>

<script src="constraints.js"></script>

<script>


function runDemo() {
	writeTableau(makeTableau([['syntree0','prostree0'], ['syntree1','prostree1']], ['matchSP-xp', 'matchPS-phi']));
	lastSegmentId++;
	logreport('<br><hr>');
	writeTableau(makeTableau([['syntree1','prostree2'], ['syntree1','prostree3']], ['matchSP-xp', 'matchPS-phi']));
	lastSegmentId++;
}

// Everything below is deprecated.


/*******************
* A bit of Javascript that allows us to see 
* the output of this program in the browser's console 
* when we open this html file in the browser to run the JS program
*******************/

/*console.log(syntree1.children);		//some optionality in the JS syntax
console.log(syntree1["children"]);
console.log(JSON.stringify(syntree1.children)); //getting text version of the object

console.log(getLeaves(syntree1));
console.log(sameIds(getLeaves(syntree1), getLeaves(syntree1)));
console.log(sameIds(getLeaves(syntree1), getLeaves(prostree1)));
console.log("This should be false.")
console.log(sameIds(getLeaves(syntree1), getLeaves(syntree0)));
console.log("running hasMatch(getLeaves(syntree1), prostree1)");
console.log(hasMatch(getLeaves(syntree1), prostree1));

console.log("Should be true: running hasMatch(getLeaves(syntree1.children[0]), prostree1)");
console.log(hasMatch(getLeaves(syntree1.children[0]), prostree1));


console.log("Should be false: running hasMatch(getLeaves(syntree1.children[0]), prostree2)");
console.log(hasMatch(getLeaves(syntree1.children[0]), prostree2));
*/

//logreport(" - violations of equalSistersAdj: 2 expected, "+equalSistersAdj(unequalSisters1)+" actual violations");
//logreport(" - violations of equalSistersAdj: 2 expected, "+equalSistersAdj(null, unequalSisters1)+" actual violations");

/*
logreport("Running matchSP(sTreeCoord, pTreeA, 'clause') - Should be 0 violations.");
logreport(matchSP(sTreeCoord, pTreeA, "clause"));
logreport("Running equalSistersAdj(sTreeCoord, pTreeA, 'clause'): 0 expected");
logreport(equalSistersAdj(sTreeCoord, pTreeA, 'clause')+" actual violations");
logreport("");

logreport("Running matchSP(sTreeCoord, pTreeB, 'clause') - Should be 2 violations (even though Myrberg has a typo & says 1 violation).");
logreport(matchSP(sTreeCoord, pTreeB, "clause"));
logreport("Running equalSistersAdj(sTreeCoord, pTreeB, 'clause'): 0 expected");
logreport(equalSistersAdj(sTreeCoord, pTreeB, 'clause')+" actual violations");
logreport("");

logreport("Running matchSP(sTreeCoord, pTreeC, 'clause') - Should be 1 violations.");
logreport(matchSP(sTreeCoord, pTreeC, "clause"));
logreport("Running equalSistersAdj(sTreeCoord, pTreeC, 'clause'): 1 expected");
logreport(equalSistersAdj(sTreeCoord, pTreeC, 'clause')+" actual violations");
logreport("");

*/


//logreport("Running matchPS(syntree0, prostree0, 'phi') - Should be 3 violations.");
//logreport("Violations: " +matchPS(syntree0, prostree0, "phi"));

//runConstraint('matchPS', 'syntree0', 'prostree0', 'phi', 3);
//runConstraint('matchSP', 'syntree0', 'prostree0', 'xp');


/*
logreport("");
logreport("Running matchSP(syntree0, prostree2, 'xp') - Should be 2 violations.");
logreport("Violations: " +matchSP(syntree1, prostree0, "xp"));


logreport("Running 3 versions of EqualSisters on unequalSisters1");
logreport(" - violations of equalSistersFirstPrivilege: 1 expected, "+equalSistersFirstPrivilege(0, unequalSisters1, 0)+" actual violations");
logreport(" - violations of equalSistersPairwise: 2 expected, "+equalSistersPairwise(unequalSisters1)+" actual violations");

logreport("Running 3 versions of EqualSisters on unequalSisters2");
logreport(" - violations of equalSistersFirstPrivilege: 2 expected, "+equalSistersFirstPrivilege(unequalSisters2)+" actual violations");
logreport(" - violations of equalSistersPairwise: 4 expected, "+equalSistersPairwise(unequalSisters2)+" actual violations");
logreport(" - violations of equalSistersAdj: 2 expected, "+equalSistersAdj(unequalSisters2)+" actual violations");

logreport("Running 3 versions of EqualSisters on unequalSisters3");
logreport(" - violations of equalSistersFirstPrivilege: 2 expected, "+equalSistersFirstPrivilege(unequalSisters3)+" actual violations");
logreport(" - violations of equalSistersPairwise: 4 expected, "+equalSistersPairwise(unequalSisters3)+" actual violations");
logreport(" - violations of equalSistersAdj: 3 expected, "+equalSistersAdj(unequalSisters3)+" actual violations");

*/

</script>

</body>

</html>
